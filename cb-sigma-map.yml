name: Carbon Black â†’ Sigma (normalized)
kind: json
rules: sigma

extensions:
  preconditions:
    - for:
        logsource.category: process_creation
      filter:
        EventType: ProcessCreate

    - for:
        logsource.category: process_termination
      filter:
        EventType: ProcessTerminate

    - for:
        logsource.category: image_load
      filter:
        EventType: ImageLoad

    - for:
        logsource.category: registry_event
      filter:
        EventType: Reg

    - for:
        logsource.category: file_event
      filter:
        EventType: File

    - for:
        logsource.category: network_connection
      filter:
        EventType: NetworkConnect

    - for:
        logsource.category: create_remote_thread
      filter:
        EventType: CreateRemoteThread

    - for:
        logsource.category: process_access
      filter:
        EventType: ProcessOpen

groups:
  - name: Sigma
    timestamp: EventTime
    filter:
      EventType: "*"
    fields:
      # Common
      - from: UtcTime
        to: EventTime
      - from: Timestamp
        to: EventTime
      - from: Hostname
        to: Host
      - from: ComputerName
        to: Host
      - from: EventType
        to: EventType

      # Actor (enclosing/source process)
      - from: SourceImage
        to: SourceImage
      - from: ProcessGuid
        to: SourceProcessId
      - from: ProcessId
        to: SourcePid

      # Process creation / childproc
      - from: Image
        to: Image
      - from: CommandLine
        to: CommandLine
      - from: User
        to: User
      - from: ParentImage
        to: ParentImage
      - from: ParentProcessId
        to: ParentProcessId
      - from: md5
        to: md5
      - from: sha256
        to: sha256

      # Image load
      - from: ImageLoaded
        to: ImageLoaded

      # Registry / File
      - from: TargetObject
        to: TargetObject
      - from: TargetFilename
        to: TargetFilename
      - from: RegOp
        to: RegOp
      - from: FileOp
        to: FileOp

      # Network
      - from: DestinationIp
        to: DestinationIp
      - from: DestinationPort
        to: DestinationPort
      - from: SourceIp
        to: SourceIp
      - from: SourcePort
        to: SourcePort
      - from: Protocol
        to: Protocol
      - from: DestinationHostname
        to: DestinationHostname
      - from: Direction
        to: Direction

      # Cross-proc
      - from: GrantedAccessMask
        to: GrantedAccessMask
      - from: GrantedAccess
        to: GrantedAccess

      # Optional signer enrichment
      - from: Company
        to: Company
      - from: Signed
        to: Signed
      - from: SignatureStatus
        to: SignatureStatus
